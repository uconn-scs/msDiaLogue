---
title: "Customizing msDiaLogue Visualizations"
output: rmarkdown::html_vignette
author: 
  - |
    Shiying Xiao$^1$, Charles Watt$^1$, Jennifer C. Liddle$^2$, Jeremy L. Balsbaugh$^2$, Timothy E. Moore$^3$
  - |
    $^1$Department of Statistics, UConn \
    $^2$Proteomics and Metabolomics Facility, UConn \
    $^3$Statistical Consulting Services, UConn
date: "`r Sys.Date()`"
bibliography:
  - ../inst/REFERENCES.bib
vignette: >
  %\VignetteIndexEntry{A Usage Template}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", fig.align = "center")
```


Many users have expressed a desire to customize msDiaLogue plots. To address
this, we will provide guidelines on how to modify ggplot objects generated by
msDiaLogue to align with the visual standards.

For R beginners, **R for Data Science** [@wickham2023r] is a fantastic resource,
available online at https://r4ds.hadley.nz/. For users particularly interested
in data visualization, **ggplot2: Elegant Graphics for Data Analysis** [@wickham2016ggplot2],
available at https://ggplot2-book.org/, is highly recommended.

The following is the preliminary to generate the default visualization in
msDiaLogue:

```{r results='hide', fig.show='hide', message=FALSE, warning=FALSE}
## Load R package
library(msDiaLogue)
## Preprocessing
fileName <- "../tests/testData/Toy_Spectronaut_Data.csv"
dataSet <- preprocessing(fileName,
                         filterNaN = TRUE, filterUnique = 2,
                         replaceBlank = TRUE, saveRm = TRUE)
## Transformation
dataTran <- transform(dataSet, logFold = 2)
## Normalization
dataNorm <- normalize(dataTran, normalizeType = "quant")
## Imputation
dataImput <- impute.min_local(dataNorm, reportImputing = FALSE,
                              reqPercentPresent = 0.51)
dataImput <- filterNA(dataImput, saveRm = TRUE)
## Analysis
ref <- "50pmol"
anlys_modt <- analyze.mod_t(dataImput, ref = ref)
anlys_ma <- analyze.ma(dataImput, ref = ref)
```


## Volcano plot

```{r}
## default volcano
visualize.volcano(anlys_modt$`100pmol-50pmol`, P.thres = 0.05, F.thres = 1)
```


### Change labels of proteins

The following code is shown to demonstrate how to replace the default labels in
the volcano plot with gene or protein names, using additional information.

```{r message=FALSE}
volcano <- visualize.volcano(anlys_modt$`100pmol-50pmol`,
                             P.thres = 0.05, F.thres = 1)

## read a csv file containing full protein information, including gene/protein names
protNames <- read.csv("full_protein_information.csv")

## change labels of proteins
library(dplyr)
volcano[["data"]] <- volcano[["data"]] %>%
  ## rename the column "Variable" to "PG.ProteinNames"
  rename(PG.ProteinNames = Variable) %>%
  ## merge the data with protNames based on the "PG.ProteinNames" column
  left_join(protNames, by  = "PG.ProteinNames") %>%
  ## change the default labels from accessions to gene/protein names
  mutate(label = ifelse(is.na(label), label, PG.Genes))

volcano
```


### Change colors

To customize the colors in your volcano plot, you can use the function
`ggplot_build()` from ggplot2. This allows you to specify custom colors for
different significance levels in the output plot.

```{r}
volcano <- visualize.volcano(anlys_modt$`100pmol-50pmol`,
                             P.thres = 0.05, F.thres = 1)

library(ggplot2)
new <- ggplot_build(volcano)
new[["plot"]][["scales"]][["scales"]][[1]][["palette.cache"]] <-
  c(Down = "purple", Up = "orange", Inconclusive = "gray", No = "gray20")

new$plot
```


### Change themes

To modify the appearance of your volcano plot, you can completely override the
current theme using ggplot2's `theme_*()` functions. Themes control the overall
look of the plot, including the background, gridlines, and text.

```{r}
volcano <- visualize.volcano(anlys_modt$`100pmol-50pmol`,
                             P.thres = 0.05, F.thres = 1)

library(ggplot2)
## use a classic theme
volcano + theme_classic()
```


## MA plot

```{r}
## default MA
visualize.ma(anlys_ma$`100pmol-50pmol`, M.thres = 0.5)
```


### Change labels of proteins

To change the labels on your plot from accession numbers to gene or protein
names, follow these steps:

```{r message=FALSE}
ma <- visualize.ma(anlys_ma$`100pmol-50pmol`, M.thres = 0.5)

## read a csv file containing full protein information, including gene/protein names
protNames <- read.csv("full_protein_information.csv")

## change labels of proteins
library(dplyr)
ma[["data"]] <- ma[["data"]] %>%
  ## rename the column "Variable" to "PG.ProteinNames"
  rename(PG.ProteinNames = Variable) %>%
  ## merge the data with protNames based on the "PG.ProteinNames" column
  left_join(protNames, by  = "PG.ProteinNames") %>%
  ## change the default labels from accessions to gene/protein names
  mutate(label = ifelse(is.na(label), label, PG.Genes))

ma
```


### Change colors

To adjust the colors in your MA plot, you can customize the color scheme to
better highlight different categories of significance. Here is how you can
modify the colors in the plot:

```{r}
ma <- visualize.ma(anlys_ma$`100pmol-50pmol`, M.thres = 0.5)

library(ggplot2)
new <- ggplot_build(ma)
new[["plot"]][["scales"]][["scales"]][[1]][["palette.cache"]] <-
  c(Down = "darkblue", No = "gray", Up = "orange")

new$plot
```


### Change themes

To alter the visual style of your MA plot, you can apply a different theme using
ggplot2's theme functions.

```{r}
ma <- visualize.ma(anlys_ma$`100pmol-50pmol`, M.thres = 0.5)

library(ggplot2)
 ## use a minimal theme
ma + theme_minimal()
```
