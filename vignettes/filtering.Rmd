---
title: "Filtering"
output: rmarkdown::html_vignette
author: 
  - |
    Shiying Xiao$^1$, Charles Watt$^1$, Jennifer C. Liddle$^2$, Jeremy L. Balsbaugh$^2$, Timothy E. Moore$^3$
  - |
    $^1$Department of Statistics, UConn \
    $^2$Proteomics and Metabolomics Facility, UConn \
    $^3$Statistical Consulting Services, UConn
date: "`r format(file.info('filtering.Rmd')$mtime, '%Y-%m-%d')`"
bibliography:
  - ../inst/REFERENCES.bib
vignette: >
  %\VignetteIndexEntry{filtering}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", fig.align = "center")
```


## Preliminary


```{r warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
## load R package
library(msDiaLogue)
## preprocessing
fileName <- "../tests/testData/Toy_Spectronaut_Data.csv"
dataSet <- preprocessing(fileName,
                         filterNaN = TRUE, filterUnique = 2,
                         replaceBlank = TRUE, saveRm = TRUE)
## transformation
dataTran <- transform(dataSet, logFold = 2)
```


## Examples


### Case 1. Remove proteins specified by the user in this step and keep everything else.


In the example below, the specific protein with the identifier "ALBU_BOVIN" will
be removed, as will anything entries with an identifier that contains the
characters "HUMAN". If `removeList = TRUE`, this function will remove what
you've specified and keep the rest.


```{r eval=FALSE}
filterOutIn(dataTran, listName = "ALBU_BOVIN", regexName = "HUMAN",
            removeList = TRUE, saveRm = TRUE)
```


<div style="overflow-x: auto;">
```{r echo=FALSE}
knitr::kable(
  filterOutIn(dataTran, listName = "ALBU_BOVIN", regexName = "HUMAN",
              removeList = TRUE, saveRm = TRUE))
```
</div>


If you want to exclude two sets of proteins and no specific ones (e.g.
contaminants and decoys, but not specifically albumin), you can drop the
`listName` designator entirely, and set the `regexName` to include a combination,
like this:


```{r eval=FALSE}
filterOutIn(dataTran, regexName = c("DECOY", "CON__"),
            removeList = TRUE, saveRm = TRUE)
```


<div style="overflow-x: auto;">
```{r echo=FALSE}
knitr::kable(
  filterOutIn(dataTran, regexName = c("DECOY", "CON__"),
              removeList = TRUE, saveRm = TRUE))
```
</div>


Keep in mind that if you only type "CON", many protein names have CON somewhere
in a text string, and those will be selected too.  This is why the contaminants
database uses two underscores to set off the identifier tag (CON__), so you can
distinguish between contaminants and proteins with names like "condensin" or
"ubiquitin-conjugating" or "domain-containing".


If `saveRm = TRUE`, the filtered-out data ("ALBU_BOVIN" + "\*HUMAN") will be
saved as a .csv file named *filtered_out_data.csv* in the current working
directory, and you can inspect this list to see what was removed.


### Case 2. Keep the proteins specified by the user in this step and remove everything else.


If we set `removeList` to FALSE, running this code will remove everything you
*didn't* specify and keep only things that matched your search terms.


```{r eval=FALSE}
filterOutIn(dataTran, listName = "ALBU_BOVIN", regexName = "HUMAN",
            removeList = FALSE)
```


<div style="overflow-x: auto;">
```{r echo=FALSE}
knitr::kable(
  filterOutIn(dataTran, listName = "ALBU_BOVIN", regexName = "HUMAN", removeList = FALSE))
```
</div>


### Extension


Besides protein names, the function `filterProtein()` provides a similar
function to filter proteins by additional protein information.


+ For **Spectronaut**: "PG.Genes", "PG.ProteinAccessions",
"PG.ProteinDescriptions", and "PG.ProteinNames".


+ For **Scaffold**: "ProteinDescriptions", "AccessionNumber", and "AlternateID".


```{r eval=FALSE}
filterProtein(dataTran, proteinInformation = "preprocess_protein_information.csv",
              text = c("Putative zinc finger protein 840", "Bovine serum albumin"),
              by = "PG.ProteinDescriptions",
              removeList = FALSE)
```


where `proteinInformation` is the file name for protein information,
automatically generated by `preprocessing()`. In this case, the proteins whose
`"PG.ProteinDescriptions"` match with "Putative zinc finger protein 840" or
"Bovine serum albumin" will be kept. Note that the search value `text` is used
for exact equality search.


<div style="overflow-x: auto;">
```{r echo=FALSE}
knitr::kable(
  filterProtein(dataTran, proteinInformation = "preprocess_protein_information.csv",
                text = c("Putative zinc finger protein 840", "Bovine serum albumin"),
                by = "PG.ProteinDescriptions",
                removeList = FALSE))
```
</div>


## Details


In some cases, a researcher may wish to filter out a specific protein or
proteins from the dataset. The most common instance of this would be proteins
identified from the common contaminants database, where we don't want something
like BSA to be matched to a human protein because the search algorithm didn't
have the correct option available, but we don't actually care about BSA itself
and want to leave it out of our visualization.  Other examples may be filtering
out entries from the decoy database (specific to a Scaffold file only, will
not be present in a Spectronaut file), or a mixed-species experiment where the
researcher wants to evaluate data from only one species at a time. This step
allows you to set aside specific proteins from downstream analysis, using either
an exact match identifier (the `listName = ` argument), or text-containing
identifiers (the `regexName = ` argument).


<div class="note">
**Note:** If both `listName` and `regexName` are defined, the proteins to be
selected or removed is the union of the two terms. \
**Keep in mind:** Removal of any proteins, including common contaminants, will
affect any global calculations performed after this step (such as normalization).
This should not be done without a clear understanding of how this will affect
your results. </div>


<div class="nav-button left-button">
<a href="transformation.html">← Previous</a>
</div>
<div class="nav-button right-button">
<a href="normalization.html">Next →</a>
</div>

